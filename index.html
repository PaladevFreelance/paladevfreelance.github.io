<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planning Bénévoles Castagnades</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="./config.js"></script>
    <style>
        @media print {
            .no-print {
                display: none !important;
            }
            @page {
                margin: 1cm;
            }
            body {
                background: white;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const { createClient } = supabase;
        const supabaseUrl = SUPABASE_CONFIG.url;
        const supabaseKey = SUPABASE_CONFIG.key;
        const supabaseClient = createClient(supabaseUrl, supabaseKey);

        const HOURS = Array.from({ length: 18 }, (_, i) => i + 6);

        const App = () => {
            const [isAdmin, setIsAdmin] = useState(false);
            const [password, setPassword] = useState('');
            const [view, setView] = useState('home');
            const [volunteers, setVolunteers] = useState([]);
            const [posts, setPosts] = useState([]);
            const [assignments, setAssignments] = useState([]);
            const [disabledSlots, setDisabledSlots] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [editingVolunteer, setEditingVolunteer] = useState(null);
            const [editingPost, setEditingPost] = useState(null);
            const [expandedPostId, setExpandedPostId] = useState(null);
            const [loading, setLoading] = useState(true);
            const [days, setDays] = useState([]);
            const [expandedDayId, setExpandedDayId] = useState(null);
            const [expandedVolunteerDays, setExpandedVolunteerDays] = useState({});
            const [expandedPostDayId, setExpandedPostDayId] = useState(null);
            const [printingVolunteerId, setPrintingVolunteerId] = useState(null);

            useEffect(() => {
                loadAllData();
            }, []);

            const loadAllData = async () => {
                setLoading(true);
                try {
                    const [volunteersData, postsData, assignmentsData, daysData, disabledSlotsData] = await Promise.all([
                        supabaseClient.from('volunteers').select('*'),
                        supabaseClient.from('posts').select('*'),
                        supabaseClient.from('assignments').select('*'),
                        supabaseClient.from('days').select('*').order('ordre'),
                        supabaseClient.from('disabled_slots').select('*')
                    ]);
                    
                    setVolunteers(volunteersData.data || []);
                    setPosts(postsData.data || []);
                    setAssignments(assignmentsData.data || []);
                    setDays(daysData.data || []);
                    setDisabledSlots(disabledSlotsData.data || []);
                } catch (error) {
                    console.error('Erreur:', error);
                }
                setLoading(false);
            };

            const handleLogin = async () => {
                const correctPasswordHash = '382caa66a7f5c82ddabdbad8102f891407791cd0356f901e109677ebe62af186';
                
                try {
                    const encoder = new TextEncoder();
                    const data = encoder.encode(password);
                    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                    const hashArray = Array.from(new Uint8Array(hashBuffer));
                    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                    
                    if (hashHex === correctPasswordHash) {
                        setIsAdmin(true);
                        setPassword('');
                    } else {
                        alert('Mot de passe incorrect');
                    }
                } catch (error) {
                    console.error('Erreur:', error);
                    alert('Erreur lors de la connexion');
                }
            };

            const handleLogout = () => {
                setIsAdmin(false);
                setView('home');
            };

            const saveVolunteer = async (volunteer) => {
                try {
                    if (volunteer.id) {
                        const { data, error } = await supabaseClient
                            .from('volunteers')
                            .update(volunteer)
                            .eq('id', volunteer.id)
                            .select();
                        if (error) throw error;
                        setVolunteers(volunteers.map(v => v.id === volunteer.id ? data[0] : v));
                    } else {
                        const { id, ...volunteerData } = volunteer;
                        const { data, error } = await supabaseClient
                            .from('volunteers')
                            .insert([volunteerData])
                            .select();
                        if (error) throw error;
                        setVolunteers([...volunteers, data[0]]);
                    }
                    setEditingVolunteer(null);
                } catch (error) {
                    alert('Erreur lors de la sauvegarde');
                }
            };

            const deleteVolunteer = async (id) => {
                if (confirm('Êtes-vous sûr de vouloir supprimer ce bénévole ?')) {
                    try {
                        await supabaseClient.from('assignments').delete().eq('volunteerId', id);
                        await supabaseClient.from('volunteers').delete().eq('id', id);
                        setVolunteers(volunteers.filter(v => v.id !== id));
                        setAssignments(assignments.filter(a => a.volunteerId !== id));
                    } catch (error) {
                        alert('Erreur lors de la suppression');
                    }
                }
            };

            const savePost = async (post) => {
                try {
                    const postData = {
                        ...post,
                        dayId: post.dayId === '' || post.dayId === undefined ? null : post.dayId
                    };
                    
                    if (postData.id) {
                        const { data, error } = await supabaseClient
                            .from('posts')
                            .update(postData)
                            .eq('id', postData.id)
                            .select();
                        if (error) throw error;
                        setPosts(posts.map(p => p.id === postData.id ? data[0] : p));
                    } else {
                        const { id, ...postDataWithoutId } = postData;
                        const { data, error } = await supabaseClient
                            .from('posts')
                            .insert([postDataWithoutId])
                            .select();
                        if (error) throw error;
                        setPosts([...posts, data[0]]);
                    }
                    setEditingPost(null);
                } catch (error) {
                    console.error('Erreur détaillée:', error);
                    alert('Erreur lors de la sauvegarde du poste: ' + (error.message || 'Erreur inconnue'));
                }
            };

            const deletePost = async (id) => {
                if (confirm('Êtes-vous sûr de vouloir supprimer ce poste ?')) {
                    try {
                        await supabaseClient.from('assignments').delete().eq('postId', id);
                        await supabaseClient.from('posts').delete().eq('id', id);
                        setPosts(posts.filter(p => p.id !== id));
                        setAssignments(assignments.filter(a => a.postId !== id));
                    } catch (error) {
                        alert('Erreur lors de la suppression');
                    }
                }
            };

            const isSlotDisabled = (postId, hour) => {
                return disabledSlots.some(slot => slot.postId === postId && slot.hour === hour);
            };

            const toggleSlotDisabled = async (postId, hour) => {
                const existingSlot = disabledSlots.find(slot => slot.postId === postId && slot.hour === hour);
                
                if (existingSlot) {
                    try {
                        await supabaseClient.from('disabled_slots').delete().eq('id', existingSlot.id);
                        setDisabledSlots(disabledSlots.filter(slot => slot.id !== existingSlot.id));
                    } catch (error) {
                        alert('Erreur lors de l\'activation du créneau');
                    }
                } else {
                    const hourAssignments = getAssignments(postId, hour);
                    if (hourAssignments.length > 0) {
                        if (!confirm('Ce créneau contient des affectations. Voulez-vous vraiment le désactiver ? Les affectations seront supprimées.')) {
                            return;
                        }
                        try {
                            for (const assignment of hourAssignments) {
                                await supabaseClient.from('assignments').delete().eq('id', assignment.id);
                            }
                            setAssignments(assignments.filter(a => !hourAssignments.find(ha => ha.id === a.id)));
                        } catch (error) {
                            alert('Erreur lors de la suppression des affectations');
                            return;
                        }
                    }
                    
                    try {
                        const { data, error } = await supabaseClient
                            .from('disabled_slots')
                            .insert([{ postId, hour }])
                            .select();
                        
                        if (error) throw error;
                        setDisabledSlots([...disabledSlots, data[0]]);
                    } catch (error) {
                        alert('Erreur lors de la désactivation du créneau');
                    }
                }
            };

            const checkConflict = (volunteerId, hour, postId) => {
                const targetPost = posts.find(p => p.id === postId);
                if (!targetPost) return false;
                
                return assignments.some(a => {
                    if (a.volunteerId !== volunteerId || a.hour !== hour || a.postId === postId) {
                        return false;
                    }
                    
                    const assignmentPost = posts.find(p => p.id === a.postId);
                    return assignmentPost && assignmentPost.dayId === targetPost.dayId;
                });
            };

            const getAssignments = (postId, hour) => {
                return assignments.filter(a => a.postId === postId && a.hour === hour);
            };

            const addAssignment = async (postId, hour, volunteerId) => {
                const targetPost = posts.find(p => p.id === postId);
                if (!targetPost) return;
                
                if (checkConflict(volunteerId, hour, postId)) {
                    const volunteer = volunteers.find(v => v.id === volunteerId);
                    const existingAssignment = assignments.find(a => {
                        if (a.volunteerId !== volunteerId || a.hour !== hour) return false;
                        const assignmentPost = posts.find(p => p.id === a.postId);
                        return assignmentPost && assignmentPost.dayId === targetPost.dayId;
                    });
                    const existingPost = posts.find(p => p.id === existingAssignment.postId);
                    const day = days.find(d => d.id === targetPost.dayId);
                    
                    if (confirm(`${volunteer.prenom} ${volunteer.nom} est déjà affecté au poste "${existingPost.nom}" à ${hour}h le ${day.nom}.\n\nVoulez-vous le déplacer vers ce nouveau poste ?`)) {
                        try {
                            await supabaseClient
                                .from('assignments')
                                .delete()
                                .eq('id', existingAssignment.id);
                            
                            const { data, error } = await supabaseClient
                                .from('assignments')
                                .insert([{ postId, hour, volunteerId }])
                                .select();
                            
                            if (error) throw error;
                            const filtered = assignments.filter(a => a.id !== existingAssignment.id);
                            setAssignments([...filtered, data[0]]);
                        } catch (error) {
                            alert('Erreur lors du déplacement');
                        }
                    }
                    return;
                }
                
                try {
                    const { data, error } = await supabaseClient
                        .from('assignments')
                        .insert([{ postId, hour, volunteerId }])
                        .select();
                    
                    if (error) throw error;
                    setAssignments([...assignments, data[0]]);
                } catch (error) {
                    alert('Erreur lors de l\'affectation');
                }
            };

            const removeAssignment = async (assignmentId) => {
                try {
                    await supabaseClient
                        .from('assignments')
                        .delete()
                        .eq('id', assignmentId);
                    
                    setAssignments(assignments.filter(a => a.id !== assignmentId));
                } catch (error) {
                    alert('Erreur lors de la suppression');
                }
            };

            const getAssignmentsByVolunteer = (volunteerId) => {
                return assignments
                    .filter(a => a.volunteerId === volunteerId)
                    .sort((a, b) => a.hour - b.hour);
            };

            const getAssignmentsByVolunteerAndDay = (volunteerId, dayId) => {
                return assignments
                    .filter(a => {
                        const post = posts.find(p => p.id === a.postId);
                        return a.volunteerId === volunteerId && post && post.dayId === dayId;
                    })
                    .sort((a, b) => a.hour - b.hour);
            };

            const printVolunteerPlanning = (volunteerId) => {
                setPrintingVolunteerId(volunteerId);
                setTimeout(() => {
                    window.print();
                    setPrintingVolunteerId(null);
                }, 100);
            };

            const mergeConsecutiveSlots = (volunteerAssignments) => {
                if (volunteerAssignments.length === 0) return [];
                
                const merged = [];
                let current = {
                    postId: volunteerAssignments[0].postId,
                    startHour: volunteerAssignments[0].hour,
                    endHour: volunteerAssignments[0].hour + 1
                };
                
                for (let i = 1; i < volunteerAssignments.length; i++) {
                    const assignment = volunteerAssignments[i];
                    
                    if (assignment.postId === current.postId && assignment.hour === current.endHour) {
                        current.endHour = assignment.hour + 1;
                    } else {
                        merged.push(current);
                        current = {
                            postId: assignment.postId,
                            startHour: assignment.hour,
                            endHour: assignment.hour + 1
                        };
                    }
                }
                
                merged.push(current);
                return merged;
            };

            const exportData = () => {
                const data = { volunteers, posts, assignments };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `planning-benevoles-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
            };

            const importData = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.volunteers) setVolunteers(data.volunteers);
                            if (data.posts) setPosts(data.posts);
                            if (data.assignments) setAssignments(data.assignments);
                            alert('Données importées avec succès !');
                        } catch (error) {
                            alert('Erreur lors de l\'importation des données');
                        }
                    };
                    reader.readAsText(file);
                }
            };

            const VolunteerModal = ({ volunteer, onSave, onClose }) => {
                const [formData, setFormData] = useState(volunteer || {
                    nom: '', prenom: '', telephone: '', email: ''
                });

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                        <div className="bg-white rounded-lg p-6 max-w-md w-full">
                            <h3 className="text-xl font-bold mb-4">
                                {volunteer ? 'Modifier' : 'Ajouter'} un bénévole
                            </h3>
                            <div className="space-y-3">
                                <input
                                    type="text"
                                    placeholder="Nom"
                                    className="w-full p-2 border rounded"
                                    value={formData.nom}
                                    onChange={e => setFormData({...formData, nom: e.target.value})}
                                />
                                <input
                                    type="text"
                                    placeholder="Prénom"
                                    className="w-full p-2 border rounded"
                                    value={formData.prenom}
                                    onChange={e => setFormData({...formData, prenom: e.target.value})}
                                />
                                <input
                                    type="tel"
                                    placeholder="Téléphone"
                                    className="w-full p-2 border rounded"
                                    value={formData.telephone}
                                    onChange={e => setFormData({...formData, telephone: e.target.value})}
                                />
                                <input
                                    type="email"
                                    placeholder="Email"
                                    className="w-full p-2 border rounded"
                                    value={formData.email}
                                    onChange={e => setFormData({...formData, email: e.target.value})}
                                />
                            </div>
                            <div className="flex gap-2 mt-4">
                                <button
                                    onClick={() => onSave(formData)}
                                    className="flex-1 bg-blue-500 text-white p-2 rounded hover:bg-blue-600"
                                >
                                    Enregistrer
                                </button>
                                <button
                                    onClick={onClose}
                                    className="flex-1 bg-gray-300 p-2 rounded hover:bg-gray-400"
                                >
                                    Annuler
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            const PostModal = ({ post, onSave, onClose, days }) => {
                const [formData, setFormData] = useState(post || {
                    nom: '', description: '', couleur: '#3B82F6', dayId: null, referent: ''
                });

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                        <div className="bg-white rounded-lg p-6 max-w-md w-full">
                            <h3 className="text-xl font-bold mb-4">
                                {post ? 'Modifier' : 'Ajouter'} un poste
                            </h3>
                            <div className="space-y-3">
                                <input
                                    type="text"
                                    placeholder="Nom du poste"
                                    className="w-full p-2 border rounded"
                                    value={formData.nom}
                                    onChange={e => setFormData({...formData, nom: e.target.value})}
                                />
                                <textarea
                                    placeholder="Description du rôle"
                                    className="w-full p-2 border rounded h-24"
                                    value={formData.description}
                                    onChange={e => setFormData({...formData, description: e.target.value})}
                                />
                                <input
                                    type="text"
                                    placeholder="Référent (nom, contact, localisation...)"
                                    className="w-full p-2 border rounded"
                                    value={formData.referent || ''}
                                    onChange={e => setFormData({...formData, referent: e.target.value})}
                                />
                                <select
                                    className="w-full p-2 border rounded"
                                    value={formData.dayId || ''}
                                    onChange={e => setFormData({...formData, dayId: e.target.value ? parseInt(e.target.value) : null})}
                                >
                                    <option value="">Sélectionner un jour</option>
                                    {days.map(day => (
                                        <option key={day.id} value={day.id}>{day.nom}</option>
                                    ))}
                                </select>
                                <div className="flex items-center gap-2">
                                    <label className="font-medium">Couleur :</label>
                                    <input
                                        type="color"
                                        className="w-16 h-10 border rounded cursor-pointer"
                                        value={formData.couleur}
                                        onChange={e => setFormData({...formData, couleur: e.target.value})}
                                    />
                                </div>
                            </div>
                            <div className="flex gap-2 mt-4">
                                <button
                                    onClick={() => onSave(formData)}
                                    className="flex-1 bg-blue-500 text-white p-2 rounded hover:bg-blue-600"
                                >
                                    Enregistrer
                                </button>
                                <button
                                    onClick={onClose}
                                    className="flex-1 bg-gray-300 p-2 rounded hover:bg-gray-400"
                                >
                                    Annuler
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            const PostInfoModal = ({ post, onClose }) => {
                if (!post) return null;
                
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" onClick={onClose}>
                        <div className="bg-white rounded-lg p-6 max-w-md w-full" onClick={e => e.stopPropagation()}>
                            <div className="flex items-center gap-3 mb-4">
                                <div
                                    className="w-8 h-8 rounded"
                                    style={{ backgroundColor: post.couleur }}
                                />
                                <h3 className="text-2xl font-bold">{post.nom}</h3>
                            </div>
                            
                            {post.referent && (
                                <div className="mb-4 p-3 bg-blue-50 rounded-lg">
                                    <p className="text-sm">
                                        <strong className="text-blue-800">Référent :</strong>
                                        <span className="text-gray-700 ml-2">{post.referent}</span>
                                    </p>
                                </div>
                            )}
                            
                            <div className="mb-6">
                                <h4 className="font-semibold text-gray-700 mb-2">Description du rôle :</h4>
                                <p className="text-gray-600 whitespace-pre-wrap">{post.description || "Aucune description disponible"}</p>
                            </div>
                            
                            <button
                                onClick={onClose}
                                className="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600"
                            >
                                Fermer
                            </button>
                        </div>
                    </div>
                );
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                        <div className="text-center">
                            <div className="text-4xl mb-4">⏳</div>
                            <div className="text-xl text-gray-600">Chargement...</div>
                        </div>
                    </div>
                );
            }

            if (!isAdmin && view === 'admin') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-xl p-8 max-w-md w-full">
                            <div className="flex items-center justify-center mb-6">
                                <span className="text-6xl">🔒</span>
                            </div>
                            <h2 className="text-2xl font-bold text-center mb-6">Administration</h2>
                            <input
                                type="password"
                                placeholder="Mot de passe"
                                className="w-full p-3 border rounded mb-4"
                                value={password}
                                onChange={e => setPassword(e.target.value)}
                                onKeyPress={e => e.key === 'Enter' && handleLogin()}
                            />
                            <button
                                onClick={handleLogin}
                                className="w-full bg-blue-500 text-white p-3 rounded hover:bg-blue-600 font-medium"
                            >
                                Se connecter
                            </button>
                            <button
                                onClick={() => setView('home')}
                                className="w-full mt-2 text-gray-600 hover:text-gray-800"
                            >
                                Retour
                            </button>
                        </div>
                    </div>
                );
            }

            const Navigation = () => (
                <div className="bg-white shadow-md mb-6">
                    <div className="container mx-auto px-4 py-4">
                        <div className="flex flex-wrap items-center justify-between gap-4">
                            <h1 className="text-2xl font-bold text-blue-600 flex items-center gap-2">
                                <span className="text-3xl">📅</span>
                                Planning Bénévoles
                            </h1>
                            <div className="flex flex-wrap gap-2">
                                <button
                                    onClick={() => setView('home')}
                                    className={`px-4 py-2 rounded ${view === 'home' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
                                >
                                    Accueil
                                </button>
                                <button
                                    onClick={() => setView('byPost')}
                                    className={`px-4 py-2 rounded ${view === 'byPost' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
                                >
                                    Par poste
                                </button>
                                <button
                                    onClick={() => setView('byVolunteer')}
                                    className={`px-4 py-2 rounded ${view === 'byVolunteer' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
                                >
                                    Par bénévole
                                </button>
                                {isAdmin ? (
                                    <>
                                        <button
                                            onClick={() => setView('admin')}
                                            className={`px-4 py-2 rounded ${view === 'admin' || view === 'volunteers' || view === 'posts' ? 'bg-green-500 text-white' : 'bg-green-100'}`}
                                        >
                                            Admin
                                        </button>
                                        <button
                                            onClick={handleLogout}
                                            className="px-4 py-2 rounded bg-red-100 hover:bg-red-200"
                                        >
                                            Déconnexion
                                        </button>
                                    </>
                                ) : (
                                    <button
                                        onClick={() => setView('admin')}
                                        className="px-4 py-2 rounded bg-gray-200 hover:bg-gray-300"
                                    >
                                        Admin
                                    </button>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );

            if (view === 'home') {
                return (
                    <div className="min-h-screen bg-gray-50">
                        <Navigation />
                        <div className="container mx-auto px-4 py-8">
                            <div className="max-w-4xl mx-auto">
                                <div className="bg-white rounded-lg shadow-lg p-8">
                                    <h2 className="text-3xl font-bold mb-6 text-center">Bienvenue sur le planning des bénévoles</h2>
                                    <div className="grid md:grid-cols-2 gap-6 mb-8">
                                        <div className="bg-blue-50 p-6 rounded-lg">
                                            <span className="text-4xl mb-3 block">👥</span>
                                            <h3 className="text-xl font-bold mb-2">Consulter par bénévole</h3>
                                            <p className="text-gray-700 mb-4">
                                                Trouvez rapidement le planning d'un bénévole spécifique
                                            </p>
                                            <button
                                                onClick={() => setView('byVolunteer')}
                                                className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
                                            >
                                                Accéder
                                            </button>
                                        </div>
                                        <div className="bg-green-50 p-6 rounded-lg">
                                            <span className="text-4xl mb-3 block">💼</span>
                                            <h3 className="text-xl font-bold mb-2">Consulter par poste</h3>
                                            <p className="text-gray-700 mb-4">
                                                Vue d'ensemble de tous les postes et leurs affectations
                                            </p>
                                            <button
                                                onClick={() => setView('byPost')}
                                                className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
                                            >
                                                Accéder
                                            </button>
                                        </div>
                                    </div>
                                    <div className="bg-gray-100 p-6 rounded-lg">
                                        <h3 className="text-lg font-bold mb-3">Statistiques</h3>
                                        <div className="grid grid-cols-3 gap-4 text-center">
                                            <div>
                                                <div className="text-3xl font-bold text-blue-600">{volunteers.length}</div>
                                                <div className="text-sm text-gray-600">Bénévoles</div>
                                            </div>
                                            <div>
                                                <div className="text-3xl font-bold text-green-600">{posts.length}</div>
                                                <div className="text-sm text-gray-600">Postes</div>
                                            </div>
                                            <div>
                                                <div className="text-3xl font-bold text-purple-600">{assignments.length}</div>
                                                <div className="text-sm text-gray-600">Affectations</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'byPost') {
                return (
                    <div className="min-h-screen bg-gray-50">
                        <Navigation />
                        <div className="container mx-auto px-4 py-8">
                            <h2 className="text-2xl font-bold mb-6">Planning par poste</h2>
                            {posts.length === 0 ? (
                                <div className="bg-white rounded-lg shadow p-8 text-center text-gray-500">
                                    Aucun poste défini pour le moment
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    {days.map(day => {
                                        const dayPosts = posts.filter(p => p.dayId === day.id);
                                        if (dayPosts.length === 0) return null;
                                        
                                        const isDayExpanded = expandedPostDayId === day.id;
                                        const totalAssignments = dayPosts.reduce((sum, post) => {
                                            return sum + assignments.filter(a => a.postId === post.id).length;
                                        }, 0);
                                        
                                        return (
                                            <div key={day.id} className="bg-white rounded-lg shadow overflow-hidden">
                                                <div
                                                    className="p-4 bg-gradient-to-r from-purple-500 to-purple-600 text-white font-bold text-lg flex items-center justify-between cursor-pointer hover:from-purple-600 hover:to-purple-700 transition-all"
                                                    onClick={() => setExpandedPostDayId(isDayExpanded ? null : day.id)}
                                                >
                                                    <div className="flex items-center gap-3">
                                                        <span className="text-2xl">📅</span>
                                                        <span>{day.nom}</span>
                                                        <span className="text-sm font-normal bg-white bg-opacity-20 px-3 py-1 rounded-full">
                                                            {dayPosts.length} poste{dayPosts.length > 1 ? 's' : ''} • {totalAssignments} affectation{totalAssignments > 1 ? 's' : ''}
                                                        </span>
                                                    </div>
                                                    <span className="text-2xl">
                                                        {isDayExpanded ? '▼' : '▶'}
                                                    </span>
                                                </div>
                                                
                                                {isDayExpanded && (
                                                    <div className="p-4">
                                                        <div className="space-y-3">
                                                            {dayPosts.map(post => {
                                                                const isPostExpanded = expandedPostId === post.id;
                                                                const postAssignments = assignments.filter(a => a.postId === post.id);
                                                                const assignedCount = postAssignments.length;
                                                                
                                                                return (
                                                                    <div key={post.id} className="border rounded-lg overflow-hidden">
                                                                        <div 
                                                                            className="p-3 text-white font-bold flex items-center justify-between cursor-pointer hover:opacity-90 transition-opacity"
                                                                            style={{ backgroundColor: post.couleur }}
                                                                            onClick={() => setExpandedPostId(isPostExpanded ? null : post.id)}
                                                                        >
                                                                            <div className="flex items-center gap-3">
                                                                                <span>{post.nom}</span>
                                                                                <span className="text-sm font-normal bg-white bg-opacity-20 px-3 py-1 rounded-full">
                                                                                    {assignedCount} affectation{assignedCount > 1 ? 's' : ''}
                                                                                </span>
                                                                            </div>
                                                                            <span className="text-xl">
                                                                                {isPostExpanded ? '▼' : '▶'}
                                                                            </span>
                                                                        </div>
                                                                        {isPostExpanded && (
                                                                            <div className="p-4 bg-gray-50">
                                                                                {post.description && (
                                                                                    <p className="text-gray-600 mb-2 italic">{post.description}</p>
                                                                                )}
                                                                                {post.referent && (
                                                                                    <p className="text-sm text-gray-700 mb-4 bg-blue-50 p-2 rounded">
                                                                                        <strong>👤 Référent :</strong> {post.referent}
                                                                                    </p>
                                                                                )}
                                                                                <div className="overflow-x-auto">
                                                                                    <table className="w-full bg-white rounded-lg overflow-hidden">
                                                                                        <thead>
                                                                                            <tr className="bg-gray-100">
                                                                                                <th className="p-2 text-left">Horaire</th>
                                                                                                <th className="p-2 text-left">Bénévoles affectés</th>
                                                                                            </tr>
                                                                                        </thead>
                                                                                        <tbody>
                                                                                            {HOURS.map(hour => {
                                                                                                if (isSlotDisabled(post.id, hour)) return null;
                                                                                                
                                                                                                const hourAssignments = getAssignments(post.id, hour);
                                                                                                return (
                                                                                                    <tr key={hour} className="border-t">
                                                                                                        <td className="p-2 font-medium">{hour}h - {hour+1}h</td>
                                                                                                        <td className="p-2">
                                                                                                            {hourAssignments.length > 0 ? (
                                                                                                                <div className="flex flex-wrap gap-2">
                                                                                                                    {hourAssignments.map(assignment => {
                                                                                                                        const volunteer = volunteers.find(v => v.id === assignment.volunteerId);
                                                                                                                        return volunteer ? (
                                                                                                                            <span 
                                                                                                                                key={assignment.id}
                                                                                                                                className="bg-blue-100 px-3 py-1 rounded-full text-sm"
                                                                                                                            >
                                                                                                                                {volunteer.prenom} {volunteer.nom}
                                                                                                                            </span>
                                                                                                                        ) : null;
                                                                                                                    })}
                                                                                                                </div>
                                                                                                            ) : (
                                                                                                                <span className="text-gray-400 italic">Non affecté</span>
                                                                                                            )}
                                                                                                        </td>
                                                                                                    </tr>
                                                                                                );
                                                                                            })}
                                                                                        </tbody>
                                                                                    </table>
                                                                                </div>
                                                                            </div>
                                                                        )}
                                                                    </div>
                                                                );
                                                            })}
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                    
                                    {posts.some(p => !p.dayId) && (
                                        <div className="bg-white rounded-lg shadow overflow-hidden">
                                            <div className="p-4 bg-gray-400 text-white font-bold text-lg flex items-center gap-3">
                                                <span className="text-2xl">❓</span>
                                                <span>Postes sans jour assigné</span>
                                            </div>
                                            <div className="p-4">
                                                <div className="space-y-2">
                                                    {posts.filter(p => !p.dayId).map(post => (
                                                        <div key={post.id} className="flex items-center gap-3 p-3 border rounded" style={{ borderLeftColor: post.couleur, borderLeftWidth: '4px' }}>
                                                            <span className="font-bold" style={{ color: post.couleur }}>{post.nom}</span>
                                                            <span className="text-sm text-gray-500 italic">Veuillez assigner un jour à ce poste</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if (view === 'byVolunteer') {
                const filteredVolunteers = volunteers.filter(v =>
                    `${v.prenom} ${v.nom}`.toLowerCase().includes(searchTerm.toLowerCase())
                );

                if (printingVolunteerId) {
                    const volunteer = volunteers.find(v => v.id === printingVolunteerId);
                    if (!volunteer) return null;
                    
                    const volunteerAssignments = getAssignmentsByVolunteer(volunteer.id);
                    const totalSlots = volunteerAssignments.length;
                    
                    return (
                        <div className="min-h-screen bg-white p-8">
                            <div className="max-w-4xl mx-auto">
                                <div className="mb-6 pb-4 border-b-2">
                                    <h1 className="text-3xl font-bold mb-2">Planning Bénévole</h1>
                                    <h2 className="text-2xl text-blue-600">{volunteer.prenom} {volunteer.nom}</h2>
                                    <p className="text-gray-600">{volunteer.telephone}</p>
                                    <p className="text-gray-600">{volunteer.email}</p>
                                    <p className="text-sm text-gray-500 mt-2">Total : {totalSlots} créneau{totalSlots > 1 ? 'x' : ''}</p>
                                </div>
                                
                                {days.map(day => {
                                    const dayAssignments = getAssignmentsByVolunteerAndDay(volunteer.id, day.id);
                                    if (dayAssignments.length === 0) return null;
                                    
                                    const mergedSlots = mergeConsecutiveSlots(dayAssignments);
                                    
                                    return (
                                        <div key={day.id} className="mb-6">
                                            <div className="bg-blue-100 p-3 mb-3">
                                                <h3 className="font-bold text-blue-800 text-xl">{day.nom}</h3>
                                                <span className="text-sm text-blue-700">{dayAssignments.length} créneau{dayAssignments.length > 1 ? 'x' : ''}</span>
                                            </div>
                                            
                                            <div className="space-y-3 ml-2">
                                                {mergedSlots.map((slot, index) => {
                                                    const post = posts.find(p => p.id === slot.postId);
                                                    return post ? (
                                                        <div key={index} className="border-l-4 pl-3 py-2" style={{ borderColor: post.couleur }}>
                                                            <div className="flex items-center gap-3 mb-1">
                                                                <span className="font-bold text-gray-700">
                                                                    {slot.startHour}h - {slot.endHour}h
                                                                </span>
                                                                <span className="font-bold text-lg" style={{ color: post.couleur }}>
                                                                    {post.nom}
                                                                </span>
                                                            </div>
                                                            {post.description && (
                                                                <p className="text-sm text-gray-600 italic mb-1">
                                                                    {post.description}
                                                                </p>
                                                            )}
                                                            {post.referent && (
                                                                <p className="text-xs text-gray-500">
                                                                    <strong>Référent :</strong> {post.referent}
                                                                </p>
                                                            )}
                                                        </div>
                                                    ) : null;
                                                })}
                                            </div>
                                        </div>
                                    );
                                })}
                                
                                {days.every(day => getAssignmentsByVolunteerAndDay(volunteer.id, day.id).length === 0) && (
                                    <div className="text-center text-gray-500 py-8">
                                        <p>Aucune affectation</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    );
                }

                return (
                    <div className="min-h-screen bg-gray-50">
                        <Navigation />
                        <div className="container mx-auto px-4 py-8">
                            <h2 className="text-2xl font-bold mb-6">Planning par bénévole</h2>
                            <div className="mb-6">
                                <div className="relative max-w-md">
                                    <span className="absolute left-3 top-3 text-gray-400">🔍</span>
                                    <input
                                        type="text"
                                        placeholder="Rechercher un bénévole..."
                                        className="w-full pl-10 pr-4 py-2 border rounded-lg"
                                        value={searchTerm}
                                        onChange={e => setSearchTerm(e.target.value)}
                                    />
                                </div>
                            </div>
                            {filteredVolunteers.length === 0 ? (
                                <div className="bg-white rounded-lg shadow p-8 text-center text-gray-500">
                                    {volunteers.length === 0 ? 'Aucun bénévole enregistré' : 'Aucun résultat'}
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    {filteredVolunteers.map(volunteer => {
                                        const volunteerAssignments = getAssignmentsByVolunteer(volunteer.id);
                                        const totalSlots = volunteerAssignments.length;
                                        
                                        return (
                                            <div key={volunteer.id} className="bg-white rounded-lg shadow">
                                                <div className="p-6 border-b">
                                                    <div className="flex items-start justify-between">
                                                        <div>
                                                            <h3 className="text-xl font-bold">
                                                                {volunteer.prenom} {volunteer.nom}
                                                            </h3>
                                                            <p className="text-gray-600">{volunteer.telephone}</p>
                                                            <p className="text-gray-600">{volunteer.email}</p>
                                                        </div>
                                                        <div className="flex items-center gap-2">
                                                            <span className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">
                                                                {totalSlots} créneau{totalSlots > 1 ? 'x' : ''}
                                                            </span>
                                                            <button
                                                                onClick={() => printVolunteerPlanning(volunteer.id)}
                                                                className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 flex items-center gap-2"
                                                                title="Imprimer le planning"
                                                            >
                                                                🖨️ PDF
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                {days.map(day => {
                                                    const dayAssignments = getAssignmentsByVolunteerAndDay(volunteer.id, day.id);
                                                    if (dayAssignments.length === 0) return null;
                                                    
                                                    const mergedSlots = mergeConsecutiveSlots(dayAssignments);
                                                    const dayKey = `${volunteer.id}-${day.id}`;
                                                    const isDayExpanded = expandedVolunteerDays[dayKey];
                                                    
                                                    return (
                                                        <div key={day.id} className="border-b last:border-b-0">
                                                            <div
                                                                className="p-4 bg-gradient-to-r from-blue-50 to-blue-100 cursor-pointer hover:from-blue-100 hover:to-blue-150 transition-all flex items-center justify-between"
                                                                onClick={() => setExpandedVolunteerDays({
                                                                    ...expandedVolunteerDays,
                                                                    [dayKey]: !isDayExpanded
                                                                })}
                                                            >
                                                                <div className="flex items-center gap-3">
                                                                    <span className="font-bold text-blue-800">{day.nom}</span>
                                                                    <span className="text-sm bg-blue-200 text-blue-800 px-2 py-1 rounded-full">
                                                                        {dayAssignments.length} créneau{dayAssignments.length > 1 ? 'x' : ''}
                                                                    </span>
                                                                </div>
                                                                <span className="text-blue-600 text-xl">
                                                                    {isDayExpanded ? '▼' : '▶'}
                                                                </span>
                                                            </div>
                                                            
                                                            {isDayExpanded && (
                                                                <div className="p-4 bg-gray-50">
                                                                    <div className="space-y-2">
                                                                        {mergedSlots.map((slot, index) => {
                                                                            const post = posts.find(p => p.id === slot.postId);
                                                                            return post ? (
                                                                                <div
                                                                                    key={index}
                                                                                    className="p-3 rounded bg-white border"
                                                                                    style={{ borderLeftColor: post.couleur, borderLeftWidth: '4px' }}
                                                                                >
                                                                                    <div className="flex items-center gap-3 mb-2">
                                                                                        <span className="font-medium text-gray-700">
                                                                                            {slot.startHour}h - {slot.endHour}h
                                                                                        </span>
                                                                                        <span className="font-bold" style={{ color: post.couleur }}>
                                                                                            {post.nom}
                                                                                        </span>
                                                                                    </div>
                                                                                    {post.description && (
                                                                                        <p className="text-sm text-gray-600 italic ml-2 mb-2">
                                                                                            {post.description}
                                                                                        </p>
                                                                                    )}
                                                                                    {post.referent && (
                                                                                        <p className="text-xs text-gray-500 ml-2">
                                                                                            <strong>Référent :</strong> {post.referent}
                                                                                        </p>
                                                                                    )}
                                                                                </div>
                                                                            ) : null;
                                                                        })}
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                                
                                                {days.every(day => getAssignmentsByVolunteerAndDay(volunteer.id, day.id).length === 0) && (
                                                    <div className="p-4 text-center">
                                                        <p className="text-gray-400 italic">Aucune affectation</p>
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if (view === 'admin' && isAdmin) {
                return (
                    <div className="min-h-screen bg-gray-50">
                        <Navigation />
                        <div className="container mx-auto px-4 py-8">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-2xl font-bold">Administration</h2>
                                <div className="flex gap-2">
                                    <button
                                        onClick={exportData}
                                        className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 flex items-center gap-2"
                                    >
                                        ⬇️ Exporter
                                    </button>
                                    <label className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 cursor-pointer flex items-center gap-2">
                                        ⬆️ Importer
                                        <input
                                            type="file"
                                            accept=".json"
                                            onChange={importData}
                                            className="hidden"
                                        />
                                    </label>
                                </div>
                            </div>

                            <div className="bg-white rounded-lg shadow mb-6">
                                <div className="flex border-b">
                                    <button
                                        className="flex-1 px-6 py-3 font-medium border-b-2 border-blue-500 text-blue-500"
                                    >
                                        📅 Planning interactif
                                    </button>
                                    <button
                                        onClick={() => setView('volunteers')}
                                        className="flex-1 px-6 py-3 font-medium text-gray-600 hover:bg-gray-50"
                                    >
                                        👥 Bénévoles
                                    </button>
                                    <button
                                        onClick={() => setView('posts')}
                                        className="flex-1 px-6 py-3 font-medium text-gray-600 hover:bg-gray-50"
                                    >
                                        💼 Postes
                                    </button>
                                </div>
                            </div>

                            <div className="bg-white rounded-lg shadow p-6">
                                <h3 className="text-xl font-bold mb-4">Planning interactif - Affectation rapide</h3>
                                
                                {posts.length === 0 || volunteers.length === 0 || days.length === 0 ? (
                                    <div className="text-center py-12 text-gray-500">
                                        <p className="mb-2">
                                            {posts.length === 0 && volunteers.length === 0 
                                                ? 'Veuillez d\'abord ajouter des postes et des bénévoles'
                                                : posts.length === 0 
                                                ? 'Veuillez d\'abord ajouter des postes'
                                                : volunteers.length === 0
                                                ? 'Veuillez d\'abord ajouter des bénévoles'
                                                : 'Aucun jour configuré dans la base de données'}
                                        </p>
                                        <div className="flex gap-4 justify-center mt-4">
                                            {posts.length === 0 && (
                                                <button
                                                    onClick={() => setView('posts')}
                                                    className="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600"
                                                >
                                                    Ajouter des postes
                                                </button>
                                            )}
                                            {volunteers.length === 0 && (
                                                <button
                                                    onClick={() => setView('volunteers')}
                                                    className="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600"
                                                >
                                                    Ajouter des bénévoles
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                ) : (
                                    <div className="space-y-3">
                                        {days.map(day => {
                                            const isDayExpanded = expandedDayId === day.id;
                                            const dayPosts = posts.filter(p => p.dayId === day.id);
                                            
                                            return (
                                                <div key={day.id} className="border rounded-lg overflow-hidden">
                                                    <div 
                                                        className="p-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold text-lg flex items-center justify-between cursor-pointer hover:from-blue-600 hover:to-blue-700 transition-all"
                                                        onClick={() => setExpandedDayId(isDayExpanded ? null : day.id)}
                                                    >
                                                        <div className="flex items-center gap-3">
                                                            <span>{day.nom}</span>
                                                            <span className="text-sm font-normal bg-white bg-opacity-20 px-3 py-1 rounded-full">
                                                                {dayPosts.length} poste{dayPosts.length > 1 ? 's' : ''}
                                                            </span>
                                                        </div>
                                                        <span className="text-2xl">
                                                            {isDayExpanded ? '▼' : '▶'}
                                                        </span>
                                                    </div>
                                                    
                                                    {isDayExpanded && (
                                                        <div className="p-4 bg-gray-50">
                                                            {dayPosts.length === 0 ? (
                                                                <div className="text-center py-8 text-gray-500">
                                                                    Aucun poste associé à ce jour
                                                                </div>
                                                            ) : (
                                                                <>
                                                                    <div className="overflow-x-auto">
                                                                        <table className="w-full border-collapse bg-white rounded-lg overflow-hidden">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th className="sticky left-0 bg-gray-100 border p-2 font-bold min-w-[150px]">
                                                                                        Poste / Horaire
                                                                                    </th>
                                                                                    {HOURS.map(hour => (
                                                                                        <th key={hour} className="bg-gray-100 border p-2 text-center min-w-[140px]">
                                                                                            {hour}h-{hour+1}h
                                                                                        </th>
                                                                                    ))}
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                {dayPosts.map(post => (
                                                                                    <tr key={post.id}>
                                                                                        <td 
                                                                                            className="sticky left-0 border p-2 font-bold text-white"
                                                                                            style={{ backgroundColor: post.couleur }}
                                                                                        >
                                                                                            {post.nom}
                                                                                        </td>
                                                                                        {HOURS.map(hour => {
                                                                                            const hourAssignments = getAssignments(post.id, hour);
                                                                                            const assignedVolunteerIds = hourAssignments.map(a => a.volunteerId);
                                                                                            const availableVolunteers = volunteers.filter(v => !assignedVolunteerIds.includes(v.id));
                                                                                            const slotDisabled = isSlotDisabled(post.id, hour);
                                                                                            
                                                                                            return (
                                                                                                <td key={hour} className={`border p-1 ${slotDisabled ? 'bg-gray-300' : 'bg-white'}`}>
                                                                                                    {slotDisabled ? (
                                                                                                        <div className="flex items-center justify-center h-full">
                                                                                                            <button
                                                                                                                onClick={() => toggleSlotDisabled(post.id, hour)}
                                                                                                                className="text-xs text-gray-600 hover:text-gray-800 underline"
                                                                                                                title="Activer ce créneau"
                                                                                                            >
                                                                                                                Créneau désactivé - Cliquer pour activer
                                                                                                            </button>
                                                                                                        </div>
                                                                                                    ) : (
                                                                                                        <div className="space-y-1">
                                                                                                            <div className="flex justify-end mb-1">
                                                                                                                <button
                                                                                                                    onClick={() => toggleSlotDisabled(post.id, hour)}
                                                                                                                    className="text-xs text-gray-400 hover:text-red-500"
                                                                                                                    title="Désactiver ce créneau"
                                                                                                                >
                                                                                                                    ⊗
                                                                                                                </button>
                                                                                                            </div>
                                                                                                            {hourAssignments.map(assignment => {
                                                                                                                const volunteer = volunteers.find(v => v.id === assignment.volunteerId);
                                                                                                                return volunteer ? (
                                                                                                                    <div 
                                                                                                                        key={assignment.id}
                                                                                                                        className="flex items-center justify-between p-1 rounded text-xs"
                                                                                                                        style={{ backgroundColor: `${post.couleur}20` }}
                                                                                                                    >
                                                                                                                        <span className="truncate">{volunteer.prenom} {volunteer.nom}</span>
                                                                                                                        <button
                                                                                                                            onClick={() => removeAssignment(assignment.id)}
                                                                                                                            className="ml-1 text-red-500 hover:text-red-700"
                                                                                                                        >
                                                                                                                            X
                                                                                                                        </button>
                                                                                                                    </div>
                                                                                                                ) : null;
                                                                                                            })}
                                                                                                            <select
                                                                                                                value=""
                                                                                                                onChange={(e) => {
                                                                                                                    if (e.target.value) {
                                                                                                                        addAssignment(post.id, hour, parseInt(e.target.value));
                                                                                                                        e.target.value = "";
                                                                                                                    }
                                                                                                                }}
                                                                                                                className="w-full p-1 text-xs border rounded bg-white cursor-pointer"
                                                                                                            >
                                                                                                                <option value="">+ Ajouter</option>
                                                                                                                {availableVolunteers.map(v => (
                                                                                                                    <option key={v.id} value={v.id}>
                                                                                                                        {v.prenom} {v.nom}
                                                                                                                    </option>
                                                                                                                ))}
                                                                                                            </select>
                                                                                                        </div>
                                                                                                    )}
                                                                                                </td>
                                                                                            );
                                                                                        })}
                                                                                    </tr>
                                                                                ))}
                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                    <div className="mt-4 p-4 bg-blue-50 rounded-lg">
                                                                        <p className="text-sm text-gray-700">
                                                                            Vous pouvez affecter plusieurs bénévoles sur le même poste au même horaire. 
                                                                            Sélectionnez "+ Ajouter" dans une case pour ajouter un bénévole, cliquez sur X pour le retirer. 
                                                                            Le système détecte automatiquement les conflits horaires.
                                                                        </p>
                                                                    </div>
                                                                </>
                                                            )}
                                                        </div>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                        </div>

                        {editingVolunteer && (
                            <VolunteerModal
                                volunteer={editingVolunteer.id ? editingVolunteer : null}
                                onSave={saveVolunteer}
                                onClose={() => setEditingVolunteer(null)}
                            />
                        )}
                        {editingPost && (
                            <PostModal
                                post={editingPost.id ? editingPost : null}
                                onSave={savePost}
                                onClose={() => setEditingPost(null)}
                                days={days}
                            />
                        )}
                    </div>
                );
            }

            if (view === 'volunteers' && isAdmin) {
                return (
                    <div className="min-h-screen bg-gray-50">
                        <Navigation />
                        <div className="container mx-auto px-4 py-8">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-2xl font-bold">Administration</h2>
                                <div className="flex gap-2">
                                    <button
                                        onClick={exportData}
                                        className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 flex items-center gap-2"
                                    >
                                        Exporter
                                    </button>
                                    <label className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 cursor-pointer flex items-center gap-2">
                                        Importer
                                        <input
                                            type="file"
                                            accept=".json"
                                            onChange={importData}
                                            className="hidden"
                                        />
                                    </label>
                                </div>
                            </div>

                            <div className="bg-white rounded-lg shadow mb-6">
                                <div className="flex border-b">
                                    <button
                                        onClick={() => setView('admin')}
                                        className="flex-1 px-6 py-3 font-medium text-gray-600 hover:bg-gray-50"
                                    >
                                        📅 Planning interactif
                                    </button>
                                    <button
                                        className="flex-1 px-6 py-3 font-medium border-b-2 border-blue-500 text-blue-500"
                                    >
                                        👥 Bénévoles
                                    </button>
                                    <button
                                        onClick={() => setView('posts')}
                                        className="flex-1 px-6 py-3 font-medium text-gray-600 hover:bg-gray-50"
                                    >
                                        💼 Postes
                                    </button>
                                </div>
                            </div>

                            <div className="bg-white rounded-lg shadow">
                                <div className="p-4 border-b flex justify-between items-center">
                                    <h3 className="text-xl font-bold flex items-center gap-2">
                                        👥 Bénévoles ({volunteers.length})
                                    </h3>
                                    <button
                                        onClick={() => setEditingVolunteer({})}
                                        className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
                                    >
                                        ➕ Ajouter
                                    </button>
                                </div>
                                <div className="p-4">
                                    {volunteers.length === 0 ? (
                                        <p className="text-gray-500 text-center py-8">Aucun bénévole enregistré</p>
                                    ) : (
                                        <div className="overflow-x-auto">
                                            <table className="w-full">
                                                <thead className="bg-gray-50">
                                                    <tr>
                                                        <th className="p-2 text-left">Nom</th>
                                                        <th className="p-2 text-left">Prénom</th>
                                                        <th className="p-2 text-left">Téléphone</th>
                                                        <th className="p-2 text-left">Email</th>
                                                        <th className="p-2 text-left">Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {volunteers.map(v => (
                                                        <tr key={v.id} className="border-t">
                                                            <td className="p-2">{v.nom}</td>
                                                            <td className="p-2">{v.prenom}</td>
                                                            <td className="p-2">{v.telephone}</td>
                                                            <td className="p-2">{v.email}</td>
                                                            <td className="p-2">
                                                                <button
                                                                    onClick={() => setEditingVolunteer(v)}
                                                                    className="text-blue-500 hover:text-blue-700 mr-2"
                                                                >
                                                                    ✏️ Modifier
                                                                </button>
                                                                <button
                                                                    onClick={() => deleteVolunteer(v.id)}
                                                                    className="text-red-500 hover:text-red-700"
                                                                >
                                                                    🗑️ Supprimer
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>

                        {editingVolunteer && (
                            <VolunteerModal
                                volunteer={editingVolunteer.id ? editingVolunteer : null}
                                onSave={saveVolunteer}
                                onClose={() => setEditingVolunteer(null)}
                            />
                        )}
                        {editingPost && (
                            <PostModal
                                post={editingPost.id ? editingPost : null}
                                onSave={savePost}
                                onClose={() => setEditingPost(null)}
                                days={days}
                            />
                        )}
                    </div>
                );
            }

            if (view === 'posts' && isAdmin) {
                return (
                    <div className="min-h-screen bg-gray-50">
                        <Navigation />
                        <div className="container mx-auto px-4 py-8">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-2xl font-bold">Administration</h2>
                                <div className="flex gap-2">
                                    <button
                                        onClick={exportData}
                                        className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 flex items-center gap-2"
                                    >
                                        Exporter
                                    </button>
                                    <label className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 cursor-pointer flex items-center gap-2">
                                        Importer
                                        <input
                                            type="file"
                                            accept=".json"
                                            onChange={importData}
                                            className="hidden"
                                        />
                                    </label>
                                </div>
                            </div>

                            <div className="bg-white rounded-lg shadow mb-6">
                                <div className="flex border-b">
                                    <button
                                        onClick={() => setView('admin')}
                                        className="flex-1 px-6 py-3 font-medium text-gray-600 hover:bg-gray-50"
                                    >
                                        📅 Planning interactif
                                    </button>
                                    <button
                                        onClick={() => setView('volunteers')}
                                        className="flex-1 px-6 py-3 font-medium text-gray-600 hover:bg-gray-50"
                                    >
                                        👥 Bénévoles
                                    </button>
                                    <button
                                        className="flex-1 px-6 py-3 font-medium border-b-2 border-blue-500 text-blue-500"
                                    >
                                        💼 Postes
                                    </button>
                                </div>
                            </div>

                            <div className="bg-white rounded-lg shadow">
                                <div className="p-4 border-b flex justify-between items-center">
                                    <h3 className="text-xl font-bold flex items-center gap-2">
                                        💼 Postes ({posts.length})
                                    </h3>
                                    <button
                                        onClick={() => setEditingPost({})}
                                        className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
                                    >
                                        ➕ Ajouter
                                    </button>
                                </div>
                                <div className="p-4">
                                    {posts.length === 0 ? (
                                        <p className="text-gray-500 text-center py-8">Aucun poste défini</p>
                                    ) : (
                                        <div className="grid md:grid-cols-2 gap-4">
                                            {posts.map(p => (
                                                <div key={p.id} className="border rounded-lg p-4">
                                                    <div className="flex items-start justify-between mb-2">
                                                        <div className="flex items-center gap-2">
                                                            <div
                                                                className="w-6 h-6 rounded"
                                                                style={{ backgroundColor: p.couleur }}
                                                            />
                                                            <h4 className="font-bold text-lg">{p.nom}</h4>
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <button
                                                                onClick={() => setEditingPost(p)}
                                                                className="text-blue-500 hover:text-blue-700"
                                                            >
                                                                ✏️ Modifier
                                                            </button>
                                                            <button
                                                                onClick={() => deletePost(p.id)}
                                                                className="text-red-500 hover:text-red-700"
                                                            >
                                                                🗑️ Supprimer
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <p className="text-gray-600 text-sm">{p.description}</p>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>

                        {editingVolunteer && (
                            <VolunteerModal
                                volunteer={editingVolunteer.id ? editingVolunteer : null}
                                onSave={saveVolunteer}
                                onClose={() => setEditingVolunteer(null)}
                            />
                        )}
                        {editingPost && (
                            <PostModal
                                post={editingPost.id ? editingPost : null}
                                onSave={savePost}
                                onClose={() => setEditingPost(null)}
                                days={days}
                            />
                        )}
                    </div>
                );
            }

            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
